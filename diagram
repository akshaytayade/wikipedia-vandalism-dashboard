graph TD
    subgraph "Data Ingestion"
        A[Wikipedia SSE Stream] --> B{Ingestion Service};
    end

    B --> C[Kafka Topic: raw_edits];

    subgraph "Real-Time Processing Pipeline"
        C --> D[Stream Processor: Flink/Spark];
        D -- Enriched Edit --> E{Vandalism Detection Engine};
        E -- Vandalism Score --> D;
        D -- Flagged Edit --> F[Kafka Topic: flagged_edits];
        D -- All Processed Edits --> G[Kafka Topic: all_edits];
    end

    subgraph "Vandalism Detection Engine"
        E --> H[Layer 1: Rule-Based Heuristics];
        E --> I[Layer 2: ML Model Service];
    end

    subgraph "Downstream Systems"
        F --> J{Alerting Service};
        J --> K[Slack/Email/Webhooks];
        G --> L{Archiving Service};
        L --> M[Data Lake / Warehouse];
        F --> N{Real-Time Dashboard};
    end

    subgraph "Offline ML Operations (MLOps)"
        M -- Historical Data --> O{Model Training Pipeline};
        O -- New Model --> P[Model Registry];
        P -- Deploy --> I;
    end

    style A fill:#f9f,stroke:#333,stroke-width:2px
    style M fill:#f9f,stroke:#333,stroke-width:2px
    style P fill:#f9f,stroke:#333,stroke-width:2px
